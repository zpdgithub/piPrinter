var fs = require('fs');
var iconv = require('iconv-lite');
var printer = '/dev/usb/lp0';

var imgData = [
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00
];

var init = Buffer.from([0x1B, 0x40]); // 13.ESC @: 初始化打印机（清除打印缓冲区数据，打印模式被设为上电时的默认值模式）
var alignCenter = Buffer.from([0x1B, 0x61, 0x01]); // 22.ESC a n: 中间对齐
var bold = Buffer.from([0x1B, 0x21, 0x08]); // 4.ESC ! n: 加粗
// var large = Buffer.from([0x1D, 0x21, 0x60]);  // 30.GS ! n: 选择字符大小 宽7高1
var txt = iconv.encode('中国Hello World!\n', 'gbk');
var img = Buffer.from([0x1D, 0x2A, 0x04, 0x04].concat(imgData)); // 31.GS * x y  定义下载位图
var printImg = Buffer.from([0x1D, 0x2F, 0x03]); // 32.GS / m: 打印下载位图
var step = Buffer.from([0x1B, 0x64, 0x01]); // 24.ESC d n: 打印并向前走纸n行
var content = Buffer.concat([init, alignCenter, bold, txt, img, printImg, step]);
console.log(content);
console.log(iconv.decode(txt, 'gbk'));
fs.writeFile(printer, content, function (error) {
    if (error) {
        console.log('error', error);
    } else {
        console.log('It\'s printed!');
    }
});